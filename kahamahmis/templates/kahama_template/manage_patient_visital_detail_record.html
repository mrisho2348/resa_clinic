{% extends 'kahama_template/base_template.html' %}
{% block title %}
Patient Details 
{% endblock title %}
{% block main_content %}
{% load static %}

<style>
      body {
            font-family: Arial, sans-serif;
        }
      /* CSS for the company logo */
.company-logo {
    max-width: 100px;
    height: 100px;
}

/* Additional styling for the header */
.header {
    background-color: #344; /* Adjust background color to match the logo */
    color: #fff;
    padding: 20px;
}

.header h1 {
    margin: 0;
    font-size: 24px;
    color: #fff; /* Set text color for consistency */
}

.header p {
    margin-bottom: 0;
}

.header a {
    color: #fff;
}

.header-info {
    font-size: 14px; /* Adjust font size for header info */
    margin-bottom: 5px; /* Add some bottom margin for spacing */
}
         /* Specific Styles for Cards */
    .patient-details-card {
        margin-bottom: 20px;
    }

    .clinical-notes-card {
        margin-bottom: 20px;
    }

    .prescription-details-card {
        margin-bottom: 20px;
    }

    .assessment-data-card {
        margin-bottom: 20px;
    }
</style>
<script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
<script src="https://use.fontawesome.com/65eb163cd4.js"></script>

<div id="invoice">
    <div class="container">
        <header class="header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-6">
                        <!-- Replace the company name with a logo -->
                        <img src="{% static 'dist/img/resalogo.png' %}" alt="Company Logo" class="company-logo">
                    </div>
                    <div class="col-6 text-right">
                        <p class="header-info">ISOAF/WASCO Site clinic, Kahama.<br> PHONE:255692082068<br> divine@resa.co.tz<br> <a href="https://www.divineheart.or.tz/" class="text-white">https://www.divineheart.or.tz/</a></p>
                    </div>
                </div>
            </div>
        </header>
    </div>
    <main class="container py-5">
        
        <div class="row">
            <div class="col-12">
                <div class="card patient-details-card">
                    <div class="card-header bg-dark text-white">
                        <h2 class="card-title">Patient Details</h2>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered">
                            <tbody>
                                <tr>
                                    <th>Patient:</th>
                                    <td> {{ patient.first_name }} {{ patient.middle_name }}  {{ patient.last_name }}</td>
                                    <th>MRN:</th>
                                    <td> {{ patient.mrn }}</td>
                                    <th>Visit Number:</th>
                                    <td> {{ visits.vst }}</td>
                                </tr>
                                <tr>
                                    <th>Age:</th>
                                    <td> {{ patient.age }}</td>
                                    <th>Gender:</th>
                                    <td> {{ patient.gender }}</td>
                                    <th>Company:</th>
                                    <td> {{ patient.company }}</td>
                                </tr>
                                <tr>
                                    <th>Phone:</th>
                                    <td> {{ patient.phone }}</td>
                                    <th>Visit Date:</th>
                                    <td> {{ visits.created_at }}</td>
                                    <th>Visit Day:</th>
                                    <td>{{ visits.created_at|date:"l" }} at {{ visits.created_at|time:"H:i" }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="row mt-5">
            <div class="col-12">
                <div class="card clinical-notes-card">
                    <div class="card-header bg-dark text-white">
                        <h2 class="card-title">Clinical Notes</h2>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered">
                            <tbody>
                                <tr>
                                    <th>Chief Complaints:</th>
                                    <td>{{ consultation_notes.chief_complaints }}</td>
                                </tr>
                                <tr>
                                    <th>History Presenting Illness:</th>
                                    <td>{{ consultation_notes.history_of_presenting_illness }}</td>
                                </tr>
                                <tr>
                                    <th>Physical Examination:</th>
                                    <td>{{ consultation_notes.physical_examination }}</td>
                                </tr>
                                <tr>
                                    <th>Allergy to Medication:</th>
                                    <td>{{ consultation_notes.allergy_to_medications }}</td>
                                </tr>
                                <tr>
                                    <th>Provisional Diagnosis:</th>
                                    <td> <ul class="list-group">
                                        {% for diagnosis in consultation_notes.provisional_diagnosis.all %}
                                        <li class="list-group-item">{{ diagnosis.diagnosis_name }}</li>
                                        {% endfor %}
                                    </ul></td>
                                </tr>
                                <tr>
                                    <th>Final Diagnosis:</th>
                                    <td> <ul class="list-group">
                                        {% for diagnosis in consultation_notes.final_diagnosis.all %}
                                        <li class="list-group-item">{{ diagnosis.diagnosis_name }}</li>
                                        {% endfor %}
                                    </ul></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    
           <!-- Prescription Details Section -->
           <div class="row mt-5">
            <div class="col-12">
                <div class="card prescription-details-card">
                    <div class="card-header bg-dark text-white">
                        <h2 class="card-title">Prescription Details</h2>
                    </div>
                    <div class="card-body">
                        <!-- Prescription Details Table -->
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Drug</th>
                                    <th>Dose</th>
                                    <th>Frequency</th>
                                    <th>Duration</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for prescription in prescriptions %}
                                                        <tr>
                                                            <td>{{ prescription.id }}</td>
                                                            <td>{{ prescription.medicine.name }}</td>
                                                            <td>{{ prescription.dose }}</td>                                                       
                                                            <td>{{ prescription.frequency }}</td>
                                                            <td>{{ prescription.duration }}</td>
                                                            <td>{{ prescription.quantity_used }}</td>
                                                            <td>{{ prescription.medicine.unit_price }}</td>
                                                            <td>{{ prescription.total_price }}</td>
                                                        </tr>
                                         {% endfor %}
                                <!-- Add additional prescription details rows here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="row mt-5">
            <div class="col-12">
                <div class="card assessment-data-card">
                    <div class="card-header bg-dark text-white">
                        <h2 class="card-title">Assessment Data</h2>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Assessment Date</th>
                                    <th>Vital Name</th>
                                    <th>Result</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if vital %}
                                <tr>
                                    <td>{{ vital.recorded_at }}</td>
                                    <td>BLOOD PRESSURE</td>
                                    <td>{{ vital.blood_pressure }}</td>
                                </tr>
                                <tr>
                                    <td>{{ vital.recorded_at }}</td>
                                    <td>HEART RATE</td>
                                    <td>{{ vital.pulse_rate }}</td>
                                </tr>
                                <tr>
                                    <td>{{ vital.recorded_at }}</td>
                                    <td>RESPIRATORY RATE</td>
                                    <td>{{ vital.respiratory_rate }}</td>
                                </tr>
                                <tr>
                                    <td>{{ vital.recorded_at }}</td>
                                    <td>OXYGEN SATURATION(SP02)</td>
                                    <td>{{ vital.spo2 }}</td>
                                </tr>
                                <tr>
                                    <td>{{ vital.recorded_at }}</td>
                                    <td>GCS</td>
                                    <td>{{ vital.gcs }}</td>
                                </tr>
                                <tr>
                                    <td>{{ vital.recorded_at }}</td>
                                    <td>WEIGHT</td>
                                    <td>{{ vital.avpu }}</td>
                                </tr>
                                <tr>
                                    <td>{{ vital.recorded_at }}</td>
                                    <td>TEMPERATURE</td>
                                    <td>{{ vital.temperature }}</td>
                                </tr>
                                {% else %}
                                no vital record 
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<div class="btn-group btn-group-sm d-print-none"> <a href="javascript:window.print()" class="btn btn-light border text-black-50 shadow-none"><i class="fa fa-print"></i> Print</a> 
    <a href="{% url 'kahamahmis:generatePDF' patient.id visits.id %}" id="dwnload" class="btn btn-light border text-black-50 shadow-none"><i class="fa fa-download"></i> Download</a> </div>
  </footer> 



<script>
    window.onload = function(){
      document.getElementById("download")
      .addEventListener("click",()=> {
       const invoice = this.document.getElementById("invoice");
     var opt = {
      filename:     'OP/SUGDUE/mrisho',
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2 },
      jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
    };
       html2pdf().from(invoice).set(opt).save();
    
      })
    }
            
        </script>
{% endblock main_content %}
